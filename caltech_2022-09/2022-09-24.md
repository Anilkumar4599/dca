# Docker networking
1. The container nework will be isolated from the host network by default for any running container:

    ```
    sudo docker run --cpu-shares 2 --detach --entrypoint php --env AUTHOR=Sebastian --expose 8080 --memory 100M --memory-reservation 100M --name phpinfo --network phpinfo-network --read-only --restart always --user nobody:nogroup --volume ${PWD}/phpinfo/:/var/data/:ro --workdir /var/data/ index.docker.io/library/php:alpine@sha256:ab23b416d86aec450ee7b75727f6bbec272edc2764a1b6fad13bc2823c59bb6b -f index.php -S 0.0.0.0:8080
    ```
1. Use the `publish` option to connect one port of the container with one port of the host machine:

    ```
    sudo docker run --cpu-shares 2 --detach --entrypoint php --env AUTHOR=Sebastian --expose 8080 --memory 100M --memory-reservation 100M --name phpinfo --network phpinfo-network --publish 8080 --read-only --restart always --user nobody:nogroup --volume ${PWD}/phpinfo/:/var/data/:ro --workdir /var/data/ index.docker.io/library/php:alpine@sha256:ab23b416d86aec450ee7b75727f6bbec272edc2764a1b6fad13bc2823c59bb6b -f index.php -S 0.0.0.0:8080
    ```
1. We can alternatively use the option `publish-all` instead of `publish`:

    ```
    sudo docker run --cpu-shares 2 --detach --entrypoint php --env AUTHOR=Sebastian --expose 8080 --memory 100M --memory-reservation 100M --name phpinfo --network phpinfo-network --publish-all --read-only --restart always --user nobody:nogroup --volume ${PWD}/phpinfo/:/var/data/:ro --workdir /var/data/ index.docker.io/library/php:alpine@sha256:ab23b416d86aec450ee7b75727f6bbec272edc2764a1b6fad13bc2823c59bb6b -f index.php -S 0.0.0.0:8080
    ```
1. The exposed container port will be published in the first available port of the host machine starting with port number `32768`. We can check that randomly chosen port with the command:

    ```
    sudo docker port phpinfo
    ```
1. In case of restarting the container, that will also change the port as we can use with the following commands:

    ```
    sudo docker restart phpinfo && sudo docker port phpinfo
    ```
1. Any environment variable included in the `docker run` command with the option `env` will be available to any application running inside the container:

    ```
    sudo docker exec phpinfo printenv | grep AUTHOR
    ```
# How to run a private Registry (instead of using public Docker Hub):
1. Run the following command on one of the workers:

    ```
    sudo docker run --detach --name registry --publish 80:5000 --restart always --user root:root --volume my_registry:/var/lib/registry/:rw index.docker.io/library/registry:2
    ```
1. We can inspect the volume used for the registry with the following command:

    ```
    sudo docker inspect my_registry
    ```
1. We can check the content of the volume with the following command:

    ```
    sudo find /var/lib/docker/volumes/my_registry/_data
    ```
1. This is the Dockerfile used for the Docker Registry image:

    * https://github.com/docker/distribution-library-image/blob/master/Dockerfile

1. Learn more about the Docker security and root capabilities:

    * https://docs.docker.com/engine/security/
